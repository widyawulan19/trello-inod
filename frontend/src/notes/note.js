[
    {
        "marketing_design_id": 33,
        "card_id": null,
        "input_by": "AYU",
        "buyer_name": "hebrewenglish99",
        "code_order": "#FO62E1B7BE148",
        "jumlah_design": 3,
        "order_number": "0249",
        "account": "FAHMISANS",
        "deadline": "2025-05-02T17:00:00.000Z",
        "jumlah_revisi": 6,
        "order_type": "REGULAR",
        "offer_type": "NEW",
        "style": "PIXEL ART",
        "resolution": "960x540",
        "price_normal": "85.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "{\"JPG\",\"PNG\",\"SOURCE FILE\"}",
        "project_type": "IMAGE 1 & 2 SIMILAR 40%",
        "reference": "CEK DETAIL PROJECT",
        "file_and_chat": "https://drive.google.com/drive/folders/1REwV4tyI57MvcOODjjBiJYURnEIPjnqZ",
        "detail_project": "FULL BRIEF BISA CEK DI SINI\nNOTE MARKETING\nBuatkan 3 image dengan rincian 2 karakter dan 1 background\nKarakter 1 : Djinni dengan looks not too muscular, looks friendly and without a sword. CEK DI SINI\nKarakter 2 : Deity a woman with 8 arms just like the reference you attached, only maybe I will create her face. CEK DI SINI\nAnimasi: hand flipping coin pada 6 tangannya (2 frame)\nImage 3: Background yang sama seperti referensi Deity buyer dengan tambahan awan di bawahnya",
        "acc_by": "FAHMI",
        "create_at": "2025-05-04T13:06:23.973Z",
        "update_at": "2025-05-14T15:08:43.282Z",
        "is_accepted": false
    },
    {
        "marketing_design_id": 36,
        "card_id": null,
        "input_by": "MIKA",
        "buyer_name": "terrortrove",
        "code_order": "#FO834B94EA708",
        "jumlah_design": 3,
        "order_number": "0254",
        "account": "FAHMISANS",
        "deadline": "2025-05-10T17:00:00.000Z",
        "jumlah_revisi": 10,
        "order_type": "REGULAR",
        "offer_type": "REPEAT",
        "style": "(diisi kadiv OP)",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "100.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "{\"JPG\",\"PNG\",\"SOURCE FILE\"}",
        "project_type": "SIMILAR 60%",
        "reference": "CEK FILE",
        "file_and_chat": "https://drive.google.com/drive/folders/1RMHbu8S_oWo8WUOBoHu5gp7h9o2HYR-_",
        "detail_project": "3 ilustrasi untuk point & click game. Lokasi: Abbey Front Door, Abbey Gate, Abbey Path 1. Tambahkan elemen interaktif seperti yang ditandai di gambar. Jaga konsistensi antar ruangan. Semua ilustrasi untuk waktu siang hari.",
        "acc_by": "-",
        "create_at": "2025-05-04T13:08:26.275Z",
        "update_at": "2025-05-04T13:33:42.237Z",
        "is_accepted": false
    },
    {
        "marketing_design_id": 35,
        "card_id": null,
        "input_by": "MIKA",
        "buyer_name": "plywooddavid",
        "code_order": "#FO72E20670147",
        "jumlah_design": 1,
        "order_number": "0252",
        "account": "ETERNAL",
        "deadline": "2025-05-10T00:00:00.000Z",
        "jumlah_revisi": 10,
        "order_type": "REGULAR",
        "offer_type": "NEW",
        "style": "(diisi kadiv OP)",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "95.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "{\"JPG\",\"PNG\",\"SOURCE FILE\"}",
        "project_type": "SIMILAR 40%",
        "reference": "CEK DETAIL",
        "file_and_chat": "https://drive.google.com/drive/folders/1q_16T66U-Q3Z0kUwzukAIpiwNLNubzl5",
        "detail_project": "Original character design berdasarkan referensi. Buyer ingin fully rendered. Tidak ada ukuran khusus (gunakan high-res standard).",
        "acc_by": "",
        "create_at": "2025-05-04T13:07:51.982Z",
        "update_at": null,
        "is_accepted": false
    },
    {
        "marketing_design_id": 39,
        "card_id": 395,
        "input_by": "MIKA",
        "buyer_name": "illustramax",
        "code_order": "#FO9271A4BXC5",
        "jumlah_design": 8,
        "order_number": "0235",
        "account": "BLAUPATKA",
        "deadline": "2025-06-12T17:00:00.000Z",
        "jumlah_revisi": 15,
        "order_type": "EXPRESS",
        "offer_type": "NEW",
        "style": "MANGA COVER ART",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "$350.00",
        "price_discount": "$50.00",
        "discount_percentage": "14.29%",
        "required_files": "JPG, PNG, PSD",
        "project_type": "CUSTOM ARTWORK",
        "reference": "TERLAMPIR \nhttps://drive.google.com/drive/folders/abc123folderLink001",
        "file_and_chat": "https://drive.google.com/drive/folders/abc123folderLink001",
        "detail_project": "Project ini bertujuan untuk membuat 8 cover manga dengan gaya ilustrasi shounen yang dinamis dan ekspresif. Masing-masing cover harus menonjolkan karakter utama dengan pose yang kuat dan ekspresi wajah yang sesuai dengan kepribadian masing-masing karakter. Detail lengkap mengenai desain karakter seperti gaya rambut, pakaian, warna dominan, dan atribut khusus sudah dikirim dalam file referensi.\\n\\nMohon diperhatikan:\\n- Ekspresi wajah harus sesuai dengan karakter (contoh: heroik, penuh semangat, tenang, misterius, dll).\\n- Proporsi tubuh, terutama tangan dan wajah, harus realistis dan konsisten antar cover.\\n- Latar belakang (background) diharapkan mendukung suasana cerita atau dunia dari masing-masing karakter.\\n\\nFile referensi (desain karakter, referensi pose, dan skema warna) serta catatan revisi awal dapat diakses melalui Google Drive (link sudah dikirim sebelumnya).\\n\\nNOTE PENTING:\\n- Perhatikan secara khusus ekspresi wajah dan proporsi tangan.\\n- Pastikan resolusi cukup tinggi untuk keperluan cetak.\\n- Gunakan layer terpisah untuk karakter dan background agar mudah direvisi jika diperlukan.",
        "acc_by": "OKTA",
        "create_at": "2025-05-25T08:11:15.812Z",
        "update_at": "2025-05-25T08:44:50.526Z",
        "is_accepted": true
    },
    {
        "marketing_design_id": 41,
        "card_id": 400,
        "input_by": "RAKA",
        "buyer_name": "illustramax",
        "code_order": "#FO9271A4BXC5",
        "jumlah_design": 8,
        "order_number": "0235",
        "account": "BLAUPATKA",
        "deadline": "2025-01-01T12:30:00.000Z",
        "jumlah_revisi": 15,
        "order_type": "EXPRESS",
        "offer_type": "NEW",
        "style": "MANGA COVER ART",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "$350.00",
        "price_discount": "$50.00",
        "discount_percentage": "14.29%",
        "required_files": "JPG, PNG, PSD",
        "project_type": "CUSTOM ARTWORK",
        "reference": "LINK",
        "file_and_chat": "https://drive.google.com/drive/folders/abc123folderLink001",
        "detail_project": "Project ini bertujuan untuk membuat 8 cover manga dengan gaya ilustrasi shounen yang dinamis dan ekspresif. Masing-masing cover harus menonjolkan karakter utama dengan pose yang kuat dan ekspresi wajah yang sesuai dengan kepribadian masing-masing karakter. Detail lengkap mengenai desain karakter seperti gaya rambut, pakaian, warna dominan, dan atribut khusus sudah dikirim dalam file referensi.\\n\\nMohon diperhatikan:\\n- Ekspresi wajah harus sesuai dengan karakter (contoh: heroik, penuh semangat, tenang, misterius, dll).\\n- Proporsi tubuh, terutama tangan dan wajah, harus realistis dan konsisten antar cover.\\n- Latar belakang (background) diharapkan mendukung suasana cerita atau dunia dari masing-masing karakter.\\n\\nFile referensi (desain karakter, referensi pose, dan skema warna) serta catatan revisi awal dapat diakses melalui Google Drive (link sudah dikirim sebelumnya).\\n\\nNOTE PENTING:\\n- Perhatikan secara khusus ekspresi wajah dan proporsi tangan.\\n- Pastikan resolusi cukup tinggi untuk keperluan cetak.\\n- Gunakan layer terpisah untuk karakter dan background agar mudah direvisi jika diperlukan.",
        "acc_by": "SARI",
        "create_at": "2025-05-25T19:43:03.006Z",
        "update_at": "2025-05-25T19:50:14.775Z",
        "is_accepted": true
    },
    {
        "marketing_design_id": 40,
        "card_id": 397,
        "input_by": "LIAANA",
        "buyer_name": "studioaluna",
        "code_order": "#FO1928830QWE9",
        "jumlah_design": 15,
        "order_number": "0788",
        "account": "ALUNASTUDIO",
        "deadline": "2025-06-01T13:00:00.000Z",
        "jumlah_revisi": 5,
        "order_type": "PREMIUM",
        "offer_type": "NEW",
        "style": "REALISTIC DIGITAL PAINTING",
        "resolution": "ULTRA HD",
        "price_normal": "750.00",
        "price_discount": "500.00",
        "discount_percentage": "33.33",
        "required_files": "TIFF, PNG, PSD",
        "project_type": "NEW PROJECT",
        "reference": "cek PDF brief dari buyer",
        "file_and_chat": "https://drive.google.com/drive/folders/folderC456HIJ",
        "detail_project": "Lukisan digital realistis untuk seri novel. Fokus pada karakter utama dan latar tempat. Terdiri dari 15 scene penting. Referensi dan urutan scene ada di brief.",
        "acc_by": "SUPERVISOR2",
        "create_at": "2025-05-25T12:31:31.744Z",
        "update_at": "2025-05-25T12:33:12.477Z",
        "is_accepted": false
    },
    {
        "marketing_design_id": 23,
        "card_id": 378,
        "input_by": "MIKA",
        "buyer_name": " r_almeida",
        "code_order": "#FO2D1DAB4342",
        "jumlah_design": 1,
        "order_number": "0211",
        "account": "ETERNAL",
        "deadline": "2025-04-09T05:47:00.000Z",
        "jumlah_revisi": 20,
        "order_type": "REGULAR ",
        "offer_type": "NEW",
        "style": "FUTURISTIC",
        "resolution": "90cm x 135cm",
        "price_normal": "100.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "JPG, PNG, SOURCE FILE",
        "project_type": "SIMILAR 60%",
        "reference": "https://drive.google.com/drive/folders/1O7M8fmjKr5UIGGIMF8S63AYd1QCuQ3fG",
        "file_and_chat": "https://drive.google.com/drive/folders/1k1NoZ0pKSq2lhhTB6sBlJeSqBPXYcICp",
        "detail_project": "I have finally found what I am looking for\nThis is what Iâ€™m looking for but this is in perspective Iâ€™d like to have it seen from above like a drone (CEK FILE BUYER)\nColor should be black, gold and red\nCan you do this king of 3d drawing? Seen from above? Like a drone or Birds Eye view. Not sure how to call it\nThis is for a big area remember. Canâ€™t just be copy paste it will require some work\nCEK FULL BRIEF DENGAN BAIK SIRR KARENA CUKUP PANJANG: FULL BRIEF\nGASSS ğŸ‘\n",
        "acc_by": "-",
        "create_at": "2025-05-04T12:49:07.696Z",
        "update_at": "2025-05-24T11:43:55.713Z",
        "is_accepted": true
    },
    {
        "marketing_design_id": 34,
        "card_id": 421,
        "input_by": "AYU",
        "buyer_name": "vickyj154",
        "code_order": "#FO11A5903E387",
        "jumlah_design": 1,
        "order_number": "0250",
        "account": "BLAUPATKA",
        "deadline": "2025-05-08T00:00:00.000Z",
        "jumlah_revisi": 10,
        "order_type": "REGULAR",
        "offer_type": "NEW",
        "style": "RETRO COMIC",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "75.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "{\"JPG\",\"PNG\",\"SOURCE FILE\"}",
        "project_type": "ORIGINAL",
        "reference": "CEK DETAIL PROJECT",
        "file_and_chat": "https://drive.google.com/drive/folders/1VCm0Hu0j5otwbwyQEwzwOWXP0n3s77cv",
        "detail_project": "Cover art untuk buku puisi/art dengan tema mental health, LGBT, grief, dll.\nGaya komik, ilustrasi monster androgini dengan kepala rusak/bergelombang.\nWarna background: lesbian flag (oranye, ungu, pink). Dalam kepala monster ada anak/monster kecil terperangkap.",
        "acc_by": "FAHMI",
        "create_at": "2025-05-04T13:07:10.240Z",
        "update_at": "2025-08-29T16:10:20.928Z",
        "is_accepted": false
    },
    {
        "marketing_design_id": 22,
        "card_id": 388,
        "input_by": "SUSAN",
        "buyer_name": "trend_designs_black_maroon_black_maroon",
        "code_order": "#PO549YTR765",
        "jumlah_design": 7,
        "order_number": "5054",
        "account": "TRENDSETTER",
        "deadline": "2025-08-12T23:24:00.000Z",
        "jumlah_revisi": 4,
        "order_type": "PREMIUM",
        "offer_type": "NEW COLLECTION",
        "style": "FASHION POSTER WITH A NEW BRAND",
        "resolution": "PRINT READY",
        "price_normal": "120.00",
        "price_discount": "100.00",
        "discount_percentage": "16.67",
        "required_files": "AI, PNG",
        "project_type": "GRAPHIC DESIGN",
        "reference": "INSTAGRAM CAMPAIGN",
        "file_and_chat": "https://drive.google.com/drive/folders/example9",
        "detail_project": "Create a series of posters for the new fashion collection, showcasing a minimalist aesthetic.",
        "acc_by": "ANDY",
        "create_at": "2025-05-04T10:56:19.233Z",
        "update_at": "2025-08-29T16:24:14.037Z",
        "is_accepted": true
    },
    {
        "marketing_design_id": 25,
        "card_id": null,
        "input_by": "MIKA",
        "buyer_name": "davemarsh912",
        "code_order": "#FO8277306ADC4",
        "jumlah_design": 10,
        "order_number": "0234",
        "account": "BLAUPATKA",
        "deadline": "2025-05-08T00:00:00.000Z",
        "jumlah_revisi": 20,
        "order_type": "REGULAR",
        "offer_type": "REPEAT",
        "style": "TAROT CARD ILLUSTRATION",
        "resolution": "HIGH RESOLUTION",
        "price_normal": "400.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "JPG, PNG, SOURCE FILE (PSD)",
        "project_type": "SIMILAR 60%",
        "reference": "CEK DI SINI",
        "file_and_chat": "https://drive.google.com/drive/folders/123nycR4tpxFI8V7Wd0XKDhKNu0UQulFX",
        "detail_project": "Okay, so there are 25 cards. I have PSD file with all of them in it. These will be shown on a page like this at the beginning of the first (of six) booksâ€¦ (CEK FILE BUYER)\nEach card represents a character or event throughout the books\nIn each book, 3-4 will be revealed so the back inside cover of that book will have those highlighted like this. (CEK FILE BUYER)\nEXCEPT, I will give you a panel from the comic that you will turn into a wood cut, replacing the existing one like thisâ€¦ (CEK FILE BUYER)\nLANJUTAN DETAILNYA: CEK FULL BRIEF SIRR\nNOTE: STYLENYA SEPERTI PROJEK SEBELUMNYA (Kode order BAFC6)\nGASSSS ğŸ‘",
        "acc_by": "",
        "create_at": "2025-05-04T12:56:01.098Z",
        "update_at": null,
        "is_accepted": false
    },
    {
        "marketing_design_id": 20,
        "card_id": 377,
        "input_by": "MIKA",
        "buyer_name": "mimimei",
        "code_order": "#FO51A54770D83",
        "jumlah_design": 1,
        "order_number": "0243",
        "account": "ETERNAL",
        "deadline": "2025-08-27T10:12:00.000Z",
        "jumlah_revisi": 10,
        "order_type": "REGULAR",
        "offer_type": "NEW",
        "style": "(diisi kadiv OP)",
        "resolution": " HIGH RESOLUTION (Best for Print)",
        "price_normal": "50.00",
        "price_discount": "0.00",
        "discount_percentage": "0.00",
        "required_files": "JPG, PNG, SOURCE FILE",
        "project_type": "ORIGINAL",
        "reference": "CEK DI SINI",
        "file_and_chat": "https://drive.google.com/drive/folders/15xgfcLYc0q9UjoCFkcn8xGI1T9n8JhBI ",
        "detail_project": "Hello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\nHello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\nHello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\nHello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\nHello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\nHello! I am working on a project for university, we are making a visual idea of a game and we were informed that we are allowed to get help from other artists. I have made up an island and drew small concepts of it but I am not very good at drawing concepts, I was wondering if you could help by drawing this made up island?\nI need Vector illustration! I have some concepts and notes of what I want included in this drawing\nI will share my concepts and notes, let me know if it's clear enough\n",
        "acc_by": "-",
        "create_at": null,
        "update_at": "2025-08-29T16:02:17.093Z",
        "is_accepted": false
    }
]


//12. get laporan data otomatis per 10 hari berjalan
app.get("/api/marketing-design/reports", async (req, res) => {
    try {
        const { mode, bulan, periode } = req.query;

        let query = "";
        let params = [];

        if (mode === "auto") {
            query = `
        SELECT *
        FROM marketing_design
        WHERE create_at::date BETWEEN
          DATE_TRUNC('month', CURRENT_DATE) +
          CASE 
            WHEN EXTRACT(DAY FROM CURRENT_DATE) BETWEEN 1 AND 10
                THEN INTERVAL '0 day'
            WHEN EXTRACT(DAY FROM CURRENT_DATE) BETWEEN 11 AND 20
                THEN INTERVAL '10 day'
            ELSE INTERVAL '20 day'
          END
          AND
          CASE 
            WHEN EXTRACT(DAY FROM CURRENT_DATE) BETWEEN 1 AND 10
                THEN DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '10 day' - INTERVAL '1 day'
            WHEN EXTRACT(DAY FROM CURRENT_DATE) BETWEEN 11 AND 20
                THEN DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '20 day' - INTERVAL '1 day'
            ELSE (DATE_TRUNC('month', CURRENT_DATE) + INTERVAL '1 month' - INTERVAL '1 day')
          END
      `;
        } else if (mode === "manual" && bulan && periode) {
            query = `
        WITH range AS (
          SELECT 
            DATE_TRUNC('month', $1::date) AS start_month,
            DATE_TRUNC('month', $1::date) + INTERVAL '1 month' - INTERVAL '1 day' AS end_month
        )
        SELECT *
        FROM marketing_design, range
        WHERE create_at::date BETWEEN
          CASE 
            WHEN $2 = 1 THEN start_month
            WHEN $2 = 2 THEN start_month + INTERVAL '10 day'
            ELSE start_month + INTERVAL '20 day'
          END
          AND
          CASE 
            WHEN $2 = 1 THEN start_month + INTERVAL '10 day' - INTERVAL '1 day'
            WHEN $2 = 2 THEN start_month + INTERVAL '20 day' - INTERVAL '1 day'
            ELSE end_month
          END
      `;
            params = [bulan + "-01", parseInt(periode, 10)];
            // params = [bulan + "-01", periode]; // contoh: bulan=2025-05, periode=2
        } else {
            return res.status(400).json({ error: "Invalid parameters" });
        }

        const result = await pool.query(query, params);
        res.json(result.rows);
    } catch (err) {
        console.error(err);
        res.status(500).json({ error: "Server error" });
    }
});


// âœ… Endpoint marketing-design per 10 hari dengan detail
app.get("/api/marketing-design/reports", async (req, res) => {
    try {
        const result = await client.query(`
      SELECT
        DATE_TRUNC('month', create_at) AS month,
        FLOOR((EXTRACT(DAY FROM create_at) - 1) / 10) + 1 AS period,
        COUNT(*) AS total,
        ARRAY_AGG(marketing_design_id) AS ids,
        JSON_AGG(
          JSON_BUILD_OBJECT(
            'marketing_design_id', marketing_design_id,
            'card id', card_id,
            'input by', input_by,
            'buyer name', buyer_name,
            'code order', code_order,
            'jumlah design', jumlah_design,
            'order number', order_number,
            'account', account,
            'deadline', deadline,
            'jumlah revisi', jumlah_revisi,
            'order type', order_type,
            'offer type', offer_type,
            'style', style,
            'resolution', resolution,
            'price normal', price_normal,
            'price discount', price_discount,
            'discount percentage', discount_percentage,
            'required files', required_files,
            'project type', project_type,
            'reference', reference,
            'file and chat', file_and_chat,
            'detail project', detail_project,
            'acc by', acc_by,
            'create at', create_at,
            'update at', update_at,
            'is accepted', is_accepted
          )
        ) AS details
      FROM marketing_design
      GROUP BY month, period
      ORDER BY month DESC, period ASC;
    `);

        res.json(result.rows);
    } catch (err) {
        console.error("âŒ Query error:", err.message);
        res.status(500).json({ error: err.message });
    }
});


const parseDate = (row) => {
    const dateStr = row.month;
    return dateStr ? new Date(dateStr) : null;
};


const filteredTenDays = tenDaysData
    .filter((row) => {
        const monthKey = new Date(row.month).toISOString().slice(0, 7);
        if (monthKey !== selectedMonth) return false;

        if (selectedRange === "1-10") return row.period === 1;
        if (selectedRange === "11-20") return row.period === 2;
        if (selectedRange === "21-31") return row.period === 3;
        return true;
    })
    .flatMap((row) => row.details); // ambil semua details dari periode
